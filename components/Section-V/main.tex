\newpage
\section{\textbf{PHÂN TÍCH VÀ THIẾT KẾ HỆ THỐNG}}

\subsection{Phân Tích Hệ Thống}

\subsubsection{Biểu đồ Use Case}

\textbf{Use Case Tổng quát} \\
Hệ thống "Nền tảng Ví điện tử Sinh viên" bao gồm các tác nhân chính và các chức năng tổng quát như sau:

\begin{itemize}
    \item \textbf{Sinh viên}: Đăng ký, Đăng nhập, Thanh toán NFC, Nạp tiền (MoMo), Xem lịch sử giao dịch, Chat với AI.
    \item \textbf{Quản trị viên}: Đăng nhập, Quản lý sinh viên (CRUD), Xem thống kê Dashboard, Quản lý giao dịch.
    \item \textbf{Hệ thống thanh toán (MoMo)}: Xử lý yêu cầu nạp tiền, Gửi thông báo kết quả (IPN).
    \item \textbf{Hệ thống AI (Gemini)}: Phản hồi câu hỏi, Phân tích chi tiêu.
\end{itemize}

% Placeholder cho hình Use Case Tổng quát
\begin{figure}[H]
    \centering
    % \includegraphics[width=1\textwidth]{image/diagrams/usecase_tongquat.png}
    \fbox{\begin{minipage}{0.8\textwidth}
        \centering
        \vspace{2cm}
        \textbf{[SƠ ĐỒ USE CASE TỔNG QUÁT - MERMAID]} \\
        Sinh viên --> (Thanh toán NFC) \\
        Sinh viên --> (Nạp tiền MoMo) \\
        Quản trị viên --> (Quản lý Dashboard)
        \vspace{2cm}
    \end{minipage}}
    \caption{Sơ đồ Use Case Tổng quát}
    \label{fig:usecase_tongquat}
\end{figure}

\subsubsection{Đặc tả các Use Case chính}

\textbf{1. Thanh toán NFC} \\
Cho phép sinh viên thanh toán tại các điểm chấp nhận (căn tin, thư viện) bằng cách chạm điện thoại vào thiết bị đọc thẻ.

\begin{longtable}{|>{\bfseries}m{4cm}|m{10cm}|}
\caption{Đặc tả Use Case: Thanh toán NFC}
\label{table:usecase-nfc}\\
\hline
Tên Use Case & Thanh toán NFC \\
\hline
Mô tả & Sinh viên sử dụng điện thoại có hỗ trợ NFC để thanh toán hóa đơn. \\
\hline
Tác nhân & Sinh viên \\
\hline
Tiền điều kiện &
\begin{itemize}
    \item Sinh viên đã đăng nhập vào ứng dụng Mobile.
    \item Điện thoại có hỗ trợ NFC và NFC đang bật.
    \item Số dư ví đủ để thanh toán.
\end{itemize} \\
\hline
Hậu điều kiện &
\begin{itemize}
    \item Số dư ví bị trừ tương ứng với số tiền thanh toán.
    \item Giao dịch được lưu vào lịch sử.
    \item Thông báo thành công hiển thị trên thiết bị.
\end{itemize} \\
\hline
Luồng sự kiện chính &
\begin{enumerate}
    \item Sinh viên chọn chức năng "Thanh toán" hoặc đưa điện thoại lại gần đầu đọc.
    \item Ứng dụng phát hiện tín hiệu NFC từ đầu đọc.
    \item Ứng dụng hiển thị thông tin giao dịch (Số tiền, Đơn vị thụ hưởng).
    \item Sinh viên xác nhận thanh toán (có thể yêu cầu PIN/Vân tay).
    \item Hệ thống xử lý trừ tiền và gửi xác nhận.
    \item Thông báo "Thanh toán thành công".
\end{enumerate} \\
\hline
Luồng thay thế &
\begin{itemize}
    \item \textbf{Số dư không đủ}: Thông báo lỗi và gợi ý nạp tiền.
    \item \textbf{Lỗi kết nối NFC}: Yêu cầu thử lại hoặc nhập mã thủ công.
\end{itemize} \\
\hline
\end{longtable}

\textbf{2. Nạp tiền qua MoMo} \\
Quy trình nạp tiền vào ví điện tử sinh viên thông qua cổng thanh toán MoMo.

\begin{longtable}{|>{\bfseries}m{4cm}|m{10cm}|}
\caption{Đặc tả Use Case: Nạp tiền qua MoMo}
\label{table:usecase-momo}\\
\hline
Tên Use Case & Nạp tiền qua MoMo \\
\hline
Mô tả & Sinh viên nạp tiền vào tài khoản ví từ ứng dụng MoMo. \\
\hline
Tác nhân & Sinh viên, Hệ thống MoMo \\
\hline
Tiền điều kiện & Sinh viên đã đăng nhập và liên kết hoặc cài đặt ứng dụng MoMo. \\
\hline
Hậu điều kiện & Số dư ví sinh viên tăng lên tương ứng số tiền nạp. \\
\hline
Luồng sự kiện chính &
\begin{enumerate}
    \item Sinh viên chọn "Nạp tiền" trên màn hình chính.
    \item Nhập số tiền cần nạp và chọn nguồn tiền "MoMo".
    \item Hệ thống chuyển hướng sang ứng dụng MoMo.
    \item Sinh viên xác nhận thanh toán trên MoMo.
    \item MoMo xử lý và gửi thông báo (IPN) về Server.
    \item Server cập nhật số dư và thông báo cho Sinh viên.
\end{enumerate} \\
\hline
Luồng thay thế &
\begin{itemize}
    \item \textbf{Hủy giao dịch}: Sinh viên hủy thanh toán trên MoMo $\rightarrow$ Quay về app, hiển thị "Giao dịch bị hủy".
    \item \textbf{Lỗi mạng}: Thông báo "Vui lòng kiểm tra kết nối".
\end{itemize} \\
\hline
\end{longtable}

\textbf{3. Chat với Trợ lý ảo AI} \\
Sinh viên tương tác với chatbot để hỏi về tài chính cá nhân.

\begin{longtable}{|>{\bfseries}m{4cm}|m{10cm}|}
\caption{Đặc tả Use Case: Chat với AI}
\label{table:usecase-ai}\\
\hline
Tên Use Case & Chat với AI Financial Advisor \\
\hline
Mô tả & Sinh viên hỏi đáp với AI về lịch sử giao dịch và nhận lời khuyên tài chính. \\
\hline
Tác nhân & Sinh viên, Hệ thống AI (Gemini) \\
\hline
Tiền điều kiện & Sinh viên đã đăng nhập. \\
\hline
Hậu điều kiện & Sinh viên nhận được câu trả lời từ AI. \\
\hline
Luồng sự kiện chính &
\begin{enumerate}
    \item Sinh viên mở màn hình Chatbot.
    \item Nhập câu hỏi (ví dụ: "Tháng này tôi tiêu bao nhiêu tiền?").
    \item Hệ thống gửi câu hỏi kèm dữ liệu ngữ cảnh (lịch sử giao dịch ẩn danh) đến Gemini API.
    \item Gemini phân tích và trả về câu trả lời văn bản.
    \item Ứng dụng hiển thị câu trả lời cho Sinh viên.
\end{enumerate} \\
\hline
\end{longtable}

\subsection{Thiết Kế Hệ Thống}

\subsubsection{Biểu đồ Activity (Hoạt động)}

\textbf{Quy trình Thanh toán NFC}

% Placeholder cho hình Activity Diagram NFC
\begin{figure}[H]
    \centering
    \fbox{\begin{minipage}{0.8\textwidth}
        \centering
        \vspace{2cm}
        \textbf{[SƠ ĐỒ ACTIVITY: THANH TOÁN NFC - MERMAID]} \\
        Start --> Detect NFC --> Confirm --> Process --> End
        \vspace{2cm}
    \end{minipage}}
    \caption{Sơ đồ hoạt động chức năng Thanh toán NFC}
    \label{fig:activity_nfc}
\end{figure}

\textbf{Quy trình Nạp tiền MoMo}

% Placeholder cho hình Activity Diagram MoMo
\begin{figure}[H]
    \centering
    \fbox{\begin{minipage}{0.8\textwidth}
        \centering
        \vspace{2cm}
        \textbf{[SƠ ĐỒ ACTIVITY: NẠP TIỀN MOMO - MERMAID]} \\
        Start --> Request Payment --> Open MoMo --> Confirm --> IPN Callback --> End
        \vspace{2cm}
    \end{minipage}}
    \caption{Sơ đồ hoạt động chức năng Nạp tiền MoMo}
    \label{fig:activity_momo}
\end{figure}

\subsubsection{Biểu đồ Sequence (Tuần tự)}

\textbf{Luồng tương tác Chatbot AI}

% Placeholder cho hình Sequence Diagram AI
\begin{figure}[H]
    \centering
    \fbox{\begin{minipage}{0.8\textwidth}
        \centering
        \vspace{2cm}
        \textbf{[SƠ ĐỒ SEQUENCE: CHATBOT AI - MERMAID]} \\
        Student -> App -> Server -> Gemini API
        \vspace{2cm}
    \end{minipage}}
    \caption{Sơ đồ tuần tự chức năng Chat AI}
    \label{fig:sequence_ai}
\end{figure}
